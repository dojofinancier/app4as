[[plugins]]
  package = "@netlify/plugin-nextjs"

[build]
  command = "npm run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "18"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# Scheduled function for cleanup of expired holds
[[functions]]
  name = "cleanup-holds"
  schedule = "* * * * *"  # Every minute

# Scheduled function for auto-completing past appointments
[[functions]]
  name = "complete-past-appointments"
  schedule = "0 * * * *"  # Every hour

# Scheduled function for database ANALYZE (updates query planner statistics)
[[functions]]
  name = "analyze-database"
  schedule = "0 2 * * 0"  # Every Sunday at 2 AM EST

# Scheduled function for cleaning up old error logs (90 days retention)
[[functions]]
  name = "cleanup-error-logs"
  schedule = "0 3 * * 0"  # Every Sunday at 3 AM EST
